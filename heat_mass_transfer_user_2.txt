{TODO:
-Revisar las ecuaciones en dispositiva 46-47, presentación convección: ¿las ecuaciones promedio cómo se aplican?
-Código para bancos de tubos
-Establecer acciones para condición de no cumplimiento: no aplica correlación->falta: 
--Leq
--q_superficial
--cruzado circulo
--cruzado cuadrado
-usar Error procedure en el resto del código->hacer desde nusselt_x_avg, 
-subprogramas para calcular integrales->es necesario?
-contrastar codigo con las ecuaciones las tablas del resúmen del cap 7, Incropera 8ed
-documentación español/inglés
-actualizar bookmarks con español/inglés}
$KeyBoard US
$UnitSystem SI K kPa kJ mass
$CHECKUNITS AutoOn
 
$Bookmark Error Caller
Procedure error_interval(n,arrayVarValues[1..n],arrayVarNames$[1..n],arrayVarInterv$[1..n]:Error$)
{$error_interval
Genera un mesaje de error personalizado para ser usado junto con 
el procedimiento en Call Error($...,...) de la forma: "correlación 
no aplicable: fuera de intervalo; VarNames$; IntervalValues$". 
 
Finalmente, indica, mediante la ventada de advertencias (Ctrl+W), 
los valores de las respectivas variables en contraste con los 
valores de los intervalos de validez.
-----------------------------------------------------------------
Generates a custom error message to be used with the procedure in 
Call Error($...,...) in the format: "correlation not applicable: 
out of range; VarNames$; IntervalValues$."
 
Finally, indicate, using the warning window (Ctrl+W), the values 
of the respective variables in contrast with the valid interval 
ranges.}
	"base out of range message construction"
	errorMsg$:='correlation not valid: out of range; '||'actual values: ['
	errorMsgIntervals$:=''
Duplicate i=1,n	"logic check"
	warningMsg$:='value of '||arrayVarNames$[i]||': (XXXF1), '||'interval ('||arrayVarInterv$[i]||')'
	Call warning(warningMsg$,arrayVarValues[i])	"generate warning"
	errorMsg$:=errorMsg$||arrayVarNames$[i]||'='||string$(arrayVarValues[i])||' '	"showing actual values"
	errorMsgIntervals$:=errorMsgIntervals$||'{'||arrayVarInterv$[i]||'}'	"intervals"
End
	Error$:=errorMsg$||']'||errorMsgIntervals$	"errorMsg completed"
End
 
$Bookmark Pi numbers/Números adimensionales
$Bookmark Thermophysical props/Props termofísicas
$Bookmark Thermophysical props/Props termofísicas: Film temp/Temp pelicula
Subprogram t_film(T_s,T_infinity:T_f)
{$T_FILM
Calcula la temperatura de pelicula, promedio, con base en la temperatura 
superficial y la temperatura del ambiente rodeando a la superficie.
 
->Todas las temperaturas deben ser suministradas en K
------------------------------------------------------------------------
Calculates the film temperature, averaged, based on the surface temperature 
and the temperature of the surrounding environment.
 
-> All temperatures must be provided in K.}
	$VarInfo T_s Units='K'	"superficial temp"
	$VarInfo T_infinity Units='K'	"enviromental temp"
	
	$VarInfo T_f Units='K'	"film temp"
	T_f=average(T_s,T_infinity)
End
$Bookmark Pi numbers/Números Adimensionales: Reynolds
Subprogram reynolds_number(rho,V,Lc,mu: Re)
{$Reynolds_number
Calcula el número de Reynolds con base en la densidad del 
fluido, su velocidad, la longitud característica y la velocidad 
dinámica.
-Re=10000, flujo interno
-Re=20000, flujo externo
-Re=500000, flujo interno con obstaculo.
------------------------------------------------------------------------
Calculates the Reynolds number based on the fluid density, 
velocity, characteristic length, and dynamic viscosity.
-Re=10000, internal flow
-Re=20000, external flow
-Re=500000, internal flow with obstacle.}
    $VarInfo rho Units='kg/m^3'	"fluid density"
    $VarInfo V Units='m/s'	"fluid velocity"
    $VarInfo Lc Units='m'	"characteristic length"
    $VarInfo mu Units='kg/m-s'	"dynamic viscosity"
    
    $VarInfo Re Units='-'	"reynolds number"
    Re = rho * V * Lc / mu
End
$Bookmark Pi numbers/Números adimensionales: Nusselt
$Bookmark Pi numbers/Números adimensionales: Nusselt: Flat plate/Placa Plana
Subprogram nusselt_number_plane(h,L,k: Nu)
{$Nusselt_NUMBER_plane
Calcula el número de Nusselt con base en el coeficiente de convección, 
la distancia desde el borde de una superficie hasta el punto deseado y 
la conductividad del fluido.
------------------------------------------------------------------------
Calculates the Nusselt number based on the convection coef, 
the distance from the edge of the surface to the desired point 
and the fluid conductivity.}
    $VarInfo h Units='W/m^2-K'	"convection coeff"
    $VarInfo L Units='m'	"distance from edge"
    $VarInfo k Units='W/m-K'	"fluid conductivity"
    
	$VarInfo Nu Units='-'	"nusselt number"
    Nu = h*L/ k
End
 
$Bookmark Forced Convection/Conveccion Forzada
$Bookmark Forced Convection/Conveccion Forzada: External/Externa
$Bookmark Forced Convection/Conveccion Forzada: External/Externa: Correlations/Correlaciones
Subprogram nusselt_number_corr(C,Re,m,Pr,n: Nu)
{$Nusselt_NUMBER_corr
Calcula el número de nusselt a partir de la correlación seleccionada, 
con base en los coeficientes C, m y n.
------------------------------------------------------------------------
Calculates the nusselt number from the selected correlation, 
bases on C,m and n coefficients.}
    $VarInfo C Units='-'	"C coeff"
    $VarInfo Re Units='-'	"Re number"
    $VarInfo m Units='-'	"m coeff"
    $VarInfo Pr Units='-'	"Pr number"
    $VarInfo n Units='-'	"n coeff"
    
    $VarInfo Nu Units='-'	"Nusselt number"
    Nu = C*Re^(m)*Pr^(n)	"correlation forms"
End
$Bookmark Forced Convection/Conveccion Forzada: External/Externa: Correlations/Correlaciones: Flat plate/Placa plana
$Bookmark Forced Convection/Conveccion Forzada: External/Externa: Correlations/Correlaciones: Flat plate/Placa plana: Local
Procedure nusselt_x(Re_x,Pr:Nu_x)
{$NUSSELT_X
Calcula el número de nusselt local, según si es flujo laminar 
o turbulento, para una placa plana, usando las correlaciones 
obtenidas en el cap 6, sec 6-10 del Cengel 6ed para transferencia.
 
Los valores no necesitan de unidades asignadas.
-----------------------------------------------------
Calculates the local Nusselt number, depending on whether the flow 
is laminar or turbulent, for a flat plate, using the correlations 
obtained in Chapter 6, Section 6-10 of Cengel 6th edition for heat 
transfer.
 
The values do not need assigned units.}
    $VarInfo Re_x Units='-'	"pi number Reynolds"
    $VarInfo Pr Units='-'	"pi number Prandtl"
	$VarInfo C Units='-'	"coeff C"
	$VarInfo m Units='-'	"coeff m"
	$VarInfo n Units='-'	"coeff n"
	
	$VarInfo Nu Units='-'	"pi number Nusselt"
    $VarInfo Nu_x Units='-'	"pi number Nusselt local"
	option$='Error'	"default case"
	If (Pr>=0.6) AND ( (Re_x>=0) AND (Re_x<500000 ) ) Then	"laminar?, Pr>=0.6?"
	option$='Laminar'
	Endif
	If (Pr<60) AND (Re_x>=500000) Then	"turbulent?, Pr<60?"
	option$='Turbulento'	
	Endif
	
	Case option$
	'Laminar':: C:=0.332
	m:=1/2
	n:=1/3
	Call nusselt_number_corr(C,Re_x,m,Pr,n:Nu)
	Nu_x:=Nu
	'Turbulento':: C:=0.0296
	m:=4/5
	n:=1/3
	Call nusselt_number_corr(C,Re_x,m,Pr,n:Nu)
	Nu_x:=Nu
	Else:: "case error"
	j=2	"amount of variables for the process"
	arrayVarValues[1..j]=[Re_x,Pr]	"vars current values"
	arrayVarNames$[1..j]=['Re_x','Pr']	"vars names"
	PrInterval$='0.6-infinity'	"laminar, Pr>=0.6?"
	If (Re_x>5*10^5) Then
	PrInterval$='0.6-60'	"turbulent, Pr<60?"
	Endif
	arrayVarInterv$[1..j]=['0-infinity',PrInterval$]	"vars valid intervals"
	Call error_interval(j,arrayVarValues[1..j],arrayVarNames$[1..j],arrayVarInterv$[1..j]:Err$)
	Call error(Err$)	"outside interval error"
	Endcase
End

$Bookmark Conveccion Forzada: Externa: Correlaciones: Placa plana: Promedio
Procedure nusselt_avg(Re_L,Pr:Nu_avg)
{$NUSSELT_avg
Calcula el número de nusselt promedio, según si es flujo laminar 
o turbulento, para una placa plana.
 
->Los valores no necesitan de unidades asignadas.
----------------------------------------------------------------
Calculates the average Nusselt number, depending on whether the flow
 is laminar or turbulent, for a flat plate.
 
-> The values do not need assigned units.}
    $VarInfo Re_L Units='-'	"pi number Reynolds"
    $VarInfo Pr Units='-'	"pi number Prandtl"
	$VarInfo C Units='-'	"coeff C"
	$VarInfo m Units='-'	"coeff m"
	$VarInfo n Units='-'	"coeff n"
	
	$VarInfo Nu Units='-'	"pi number Nusselt"
    $VarInfo Nu_avg Units='-'	"pi number Nusselt avg"
	option$='Error'
	If (Pr>=0.6) AND ( (Re_L>=0) AND (Re_L<500000 ) ) Then	"laminar flow?, Pr>=0.6?"
	option$='Laminar'
	Endif
	If (Pr<60) AND ( (Re_L>=500000) AND (Re_L<=999*10^7) ) Then	"turbulento flow?, Pr<60?"
	option$='Turbulento'	
	Endif
	
	Case option$
	'Laminar':: C:=0.664
	m:=1/2
	n:=1/3
	Call nusselt_number_corr(C,Re_L,m,Pr,n:Nu)
	Nu_avg:=Nu
	'Turbulento':: C:=0.037
	m:=4/5
	n:=1/3
	Call nusselt_number_corr(C,Re_L,m,Pr,n:Nu)
	Nu_avg:=Nu
	Else:: "caso error"
	j=2	"amount of input variables for the process"
	arrayVarValues[1..j]=[Re_L,Pr]	"vars current values"
	arrayVarNames$[1..j]=['Re_L','Pr']	"error potential vars"
	PrInterval$='0.6-infinity'	"laminar flow, Pr>=0.6?"
	ReTurbulentInterval$='0-infinity'	"laminar flow"
	If (Re_x>5*10^5) Then
	PrInterval$='0.6-60'	"turbulent flow, Pr<=60?"
	ReTurbulentInterval$='0-999*10^7'
	Endif
	arrayVarInterv$[1..j]=[ReTurbulentInterval$,PrInterval$]	"error potential intervals"
	Call error_interval(j,arrayVarValues[1..j],arrayVarNames$[1..j],arrayVarInterv$[1..j]:Err$)
	Call error(Err$)	"outside of interval"
	Endcase
End

$Bookmark Forced Convection/Conveccion Forzada: External/Externa: Correlations/Correlaciones: Flat plate/Placa plana: Temp constant long/Longitud a temp cte
Procedure nusselt_x_leq(Re_x,Pr,x,xi:Nu_x)
{$NUSSELT_X_LEQ
Calcula el número de nusselt local, según si es flujo laminar o turbulento, para una placa plana 
con una sección no calentada o en equilibrio térmico con el ambiente}
    $VarInfo Re_x Units='-'	"pi number Reynolds"
    $VarInfo Pr Units='-'	"pi number Prandtl"
	$VarInfo x Units='m'	"distance calculation"
	$VarInfo xi Units='m'	"equilibrium distance"
 	
	$VarInfo Nu Units='-'	"pi number Nusselt"
    $VarInfo Nu_x Units='-'	"pi number Nusselt local"
	option$='Error'
	If (x>=xi) Then	"equilibrium long>distance calculation?"
	If (Re_x<500000) Then	"laminar flow?"
	option$='Laminar'
	Endif
	If (Re_x>=5*10^(5)) Then	"turbulent flow?"
	option$='Turbulento'
	Endif
	Endif
	
	Case option$
	'Laminar'::Call nusselt_x(Re_x,Pr:Nu)	"call nusselt local, laminar plate"
	Nu_x:=Nu/( 1-(xi/x)^(3/4) )^(1/3)
	'Turbulento'::Call nusselt_x(Re_x,Pr:Nu)	"call nusselt local, turbulent plate"
	Nu_x:=Nu/( 1-(xi/x)^(9/10) )^(1/9)	
	Else:: "caso error"
	j=1	"amount of input variables for the process"
	arrayVarValues[1..j]=[Re_x]	"vars current values"
	arrayVarNames$[1..j]=['Re_x']	"error potential vars"
	ReTurbulentInterval$='0-infinity'	"laminar flow"
	arrayVarInterv$[1..j]=[ReTurbulentInterval$]	"error potential intervals"
	Call error_interval(j,arrayVarValues[1..j],arrayVarNames$[1..j],arrayVarInterv$[1..j]:Err$)
	Call error(Err$)	"outside of interval"
	Endcase
End

$Bookmark Forced Convection/Conveccion Forzada: External/Externa: Correlations/Correlaciones: Flat plate/Placa plana: Uniform Superficial Heat/Calor superficial uniforme
Procedure nusselt_x_q_uniform(Re_x,Pr:Nu_x)
{$NUSSELT_X_q_uniform
Calcula el número de nusselt local, según si es flujo laminar o 
turbulento, para una placa plana, en condición de calor 
superficial uniforme
------------------------------------------------------------------------
Calculate the local Nusselt number, depending on whether the flow 
is laminar or turbulent, for a flat plate under uniform surface 
heat conditions.}
	$VarInfo Re_x Units='-'	"pi number Reynolds"
    $VarInfo Pr Units='-'	"pi number Prandtl"
	$VarInfo C Units='-'	"coeff C"
	$VarInfo m Units='-'	"coeff m"
	$VarInfo n Units='-'	"coeff n"
	
	$VarInfo Nu Units='-'	"pi number Nusselt"
    $VarInfo Nu_x Units='-'	"pi number Nusselt local"
	option$='Error'	"default case"
	If (Pr>=0.6) AND ( (Re_x>=0) AND (Re_x<500000 ) ) Then	"laminar?, Pr>=0.6?"
	option$='Laminar'
	Endif
	If (Pr<60) AND (Re_x>=500000) Then	"turbulent?, Pr<60?"
	option$='Turbulento'	
	Endif
	
	Case option$
	'Laminar':: C:=0.453
	m:=1/2
	n:=1/3
	Call nusselt_number_corr(C,Re_x,m,Pr,n:Nu)
	Nu_x:=Nu
	'Turbulento':: C:=0.0308
	m:=4/5
	n:=1/3
	Call nusselt_number_corr(C,Re_x,m,Pr,n:Nu)
	Nu_x:=Nu
	Else:: "case error"
	j=2	"amount of variables for the process"
	arrayVarValues[1..j]=[Re_x,Pr]	"vars current values"
	arrayVarNames$[1..j]=['Re_x','Pr']	"vars names"
	ReInterval$='0-infinity'
	PrInterval$='0.6-infinity'	"laminar, Pr>=0.6?"
	If (Re_x>5*10^5) Then
	PrInterval$='0.6-60'	"turbulent, Pr<60?"
	Endif
	arrayVarInterv$[1..j]=[ReInterval$,PrInterval$]	"vars valid intervals"
	Call error_interval(j,arrayVarValues[1..j],arrayVarNames$[1..j],arrayVarInterv$[1..j]:Err$)
	Call error(Err$)	"outside interval error"
	Endcase
End

$Bookmark Forced Convection/Conveccion Forzada: External/Externa: Correlations/Correlaciones: Crossflow/Flujo cruzado
$Bookmark Forced Convection/Conveccion Forzada: External/Externa: Correlations/Correlaciones: Crossflow/Flujo cruzado: Cylinder/Cilindro
Procedure nusselt_circulo(Re, Pr: Nu_avg)
{$Nusselt_Circulo
Calcula el número de Nusselt promedio para cilindros con 
sección transversal circular en flujo cruzado. Aplica para 
gas o líquido.
----------------------------------------------------------
Calculate the average Nusselt number for cylinders with a 
circular cross-section in cross-flow. Applicable for gas 
or liquid.}
    $VarInfo Re Units='-' "Número de Reynolds"
    $VarInfo Pr Units='-' "Número de Prandtl"
	$VarInfo C Units='-'	"coeficiente C"
	$VarInfo m Units='-'	"coeficiente m"
	$VarInfo n Units='-'	"coeficiente n"
	
	$VarInfo Nu Units='-'	"pi number Nusselt"
    $VarInfo Nu_avg Units='-' "Número de Nusselt promedio"
	option$='Error'	"default case"
    n:=1/3
	ReInterval$='0.4-400000'	"valid interval Re"
	If (Re >= 0.4) AND (Re < 4) Then
	option$='1'
	Endif
    If (Re >= 4) AND (Re < 40) Then
	option$='2'
	Endif
    If (Re >= 40) AND (Re < 4000) Then
	option$='3'
	Endif
    If (Re >= 4000) AND (Re < 40000) Then
	option$='4'
	Endif
    If (Re >= 40000) AND (Re < 400000) Then
	option$='5'
	Endif
	
	Case option$
	'1':: C:=0.989
	m:=0.33
	Call nusselt_number_corr(C,Re_x,m,Pr,n:Nu)
	Nu_avg :=Nu
	'2':: C:=0.911
	m:=0.385
	Call nusselt_number_corr(C,Re_x,m,Pr,n:Nu)
	Nu_avg := Nu
	'3':: C:=0.683
	m:=0.466
	Call nusselt_number_corr(C,Re_x,m,Pr,n:Nu)
	Nu_avg := Nu
	'4':: C:=0.193
	m:=0.618
	Call nusselt_number_corr(C,Re_x,m,Pr,n:Nu)
	Nu_avg := Nu
	'5':: C:=0.027
	m:=0.805
	Call nusselt_number_corr(C,Re_x,m,Pr,n:Nu)
	Nu_avg := Nu
	Else:: "case error"
	j=2	"amount of variables for the process"
	arrayVarValues[1..j]=[Re,Pr]	"vars current values"
	arrayVarNames$[1..j]=['Re','Pr']	"vars names"
	PrInterval$='0-infinity'	"laminar, Pr>=0.6?"
	arrayVarInterv$[1..j]=[ReInterval$,PrInterval$]	"vars valid intervals"
	Call error_interval(j,arrayVarValues[1..j],arrayVarNames$[1..j],arrayVarInterv$[1..j]:Err$)
	Call error(Err$)	"outside interval error"
	Endcase
End